%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Manuscript started: 2007/09/01
% First completed draft: 2008/05/12, Vitamin D, Inc.
% Submission draft: 2008/06/08, Vitamin D, Inc.
% Resubmission draft: 2008/11/15, Vitamin D, Inc.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\documentclass[fleqn,12pt,twoside,draft]{article}
\documentclass[fleqn,12pt,twoside]{article}
\usepackage[headings]{espcrc1}
\usepackage{amsmath}
\usepackage{graphicx}
\PassOptionsToPackage{ctagsplt,righttag}{amsmath}
\usepackage{multirow}

\include{macros}


%******************************SIZE DECLARATIONS********************************
\topmargin -0.7in


%*******************************DOCUMENT BEGIN**********************************

\begin{document}
\bibliographystyle{unsrt}

\title{Boosting the Accuracy of Finite Difference Schemes 
       via Optimal Time Step Selection}

\author{K. T. Chu\address{Vitamin D, Inc., Menlo Park, CA 94025}$^,$\address{Institute of High Performance Computing, A*STAR, Singapore, Singapore} 
}

\runtitle{Optimal Time Step Selection for FD Schemes}
\runauthor{K. T. Chu}

\maketitle

\noindent \rule{6.3in}{1pt}

\begin{abstract}
In this article, we present a novel technique for boosting the order of 
accuracy of formally low-order finite difference schemes for time dependent 
partial differential equations by optimally selecting the time step used
to advance the numerical solution.  This technique allows us to extract as
much accuracy as possible from existing finite difference schemes with 
minimal additional effort.  Through straightforward numerical 
analysis arguments, we explain the origin of the boost in accuracy and 
estimate the computational cost of the resulting numerical 
method.  We demonstrate the utility of optimal time step (OTS) selection on a 
wide array of classical PDEs in one and more space dimensions to illustrate 
its applicability to linear and semilinear PDEs on both regular and irregular 
domains.  
\end{abstract}

\noindent \rule{6.3in}{1pt}


\section{Introduction}
High-order numerical methods for partial differential equations (PDEs) will 
always be valuable for increasing the computational efficiency of numerical 
simulations.  Thus, it is not at all surprising that a great deal of effort in 
numerical PDEs continues to be focused on the development of high-order 
numerical 
schemes~\cite{bruger_2005,gibou_2005,ito_2005,shukla_2005,shukla_2007}.  
Typically, high-order accuracy is achieved by constructing
schemes that are formally high-order accurate.  However, high-order 
accuracy can also be obtained by using formally low-order schemes in clever 
ways (\eg Richardson extrapolation and compact finite difference schemes).  
When possible, the latter approach can be a powerful way to boost the accuracy 
of a numerical method \emph{without} introducing too much additional 
algorithmic (and programming) complexity.

Optimization of numerical parameters (\eg $\dx$ and $\dt$) is an important, 
but relatively uncommon, approach for maximizing the accuracy of numerical 
schemes.  Often, all combinations of numerical parameters are considered 
equally good.  That is, the simplest model of the error as a function 
of the numerical parameters is assumed:  each numerical parameter contributes
independently to the error.  For some problems, however, optimizing the 
numerical parameters can significantly increase the accuracy of the 
numerical solution.  For example, in~\cite{zhao_2006}, Zhao showed that 
choosing an appropriate value for the weight factor $\theta$ in the 
theta-method can decrease the error in finite element solutions to the 
diffusion equation. 

In this paper, we present a novel technique for boosting the order of 
accuracy of finite difference schemes for time dependent PDEs by optimally 
choosing the time step (and possibly adding a few correction terms).  
Optimal time step (OTS) selection is a simple method based on the observation 
that a carefully chosen time step can eliminate low-order terms in the 
discretization error, allowing a formally low-order method to deliver 
high-order accuracy.  It combines the well-known approach of using knowledge 
of the structure of the PDE to reduce numerical error with the less-common 
notion that an optimal choice of numerical parameters can boost the 
effectiveness of algorithmically simple and computationally low-cost numerical 
schemes.  

As a technique for enhancing numerical methods, optimal time step selection 
has several desirable features.  Like any technique that leads to high-order 
methods, optimal time step selection produces schemes that greatly reduce the 
computational cost required to obtain a numerical solution of a desired 
accuracy.  However, its real power comes from the fact that it achieves
high-order accuracy while being based solely on very simple, formally 
low-order finite difference schemes.  In other words, OTS selection allows us
to extract as much accuracy as possible from an existing numerical scheme
with minimal additional work.  For instance, we will see how optimal time step 
selection makes it possible to achieve 4th-order accuracy for the diffusion 
equation using only a second-order stencil for the Laplacian and forward 
Euler time integration.  Moreover, high-order accuracy is not restricted to 
problems on simple, rectangular domains; irregular domains are straightforward 
to handle by appropriately setting the values in ghost 
cells~\cite{gibou_2005,ito_2005,fedkiw_1999,osher_fedkiw_book}.  
Optimal time step selection is even beneficial when 
using finite difference schemes to solve some nonlinear PDEs.  While there 
are certainly limitations to optimal time step selection, we will see that 
there are many problems where it is useful.  

It is worth spending a few moments to draw the distinction between optimal 
time step selection and traditional adaptive time stepping 
techniques~\cite{iserles_book,shampine_2005} that are used in the 
context of the method of lines~\cite{iserles_book,gko_book}.  
While both methods reduce numerical error by controlling the time step, the 
numerical errors they control are fundamentally different.  Adaptive time 
stepping can only be used to reduce temporal discretization errors because it 
controls the errors that arise when solving the coupled system of ODEs for the 
semi-discrete approximation to the PDE; the spatial discretization errors 
are completely controlled by the finite difference scheme selected to 
approximate the spatial derivatives.  
In contrast, optimal time step selection simultaneously reduces 
\emph{both} the spatial and temporal discretization errors because it
uses information from the PDE to choose the time step.  Another important 
distinction between the two techniques is that optimal time step selection 
uses a \emph{fixed} time step which makes it significantly less 
computationally complex than adaptive time stepping methods.

The remainder of this paper is organized as follows.  
In Section~\ref{sec:optimal_time_step_selection}, we begin by 
discussing the technique of optimal time step selection and 
presenting the analysis that explains how it boosts the order of accuracy 
for formally low-order numerical schemes.  In 
Section~\ref{sec:applications_1d}, we demonstrate the utility of 
optimal time selection to problems in one space dimension by applying it to 
finite difference schemes for several classical linear and nonlinear PDEs. 
In Section~\ref{sec:applications_multidim}, we show that optimal time step
selection is useful for problems in multiple space dimensions by applying it
the 2D linear advection equation and the 2D diffusion equation.  To illustrate 
the ease with which high-order accuracy can be achieved for problems on 
arbitrary domains, the 2D diffusion equation is solved on both regular 
and irregular domains.  
For each PDE in Sections~\ref{sec:applications_1d} and 
\ref{sec:applications_multidim}, we provide the numerical analysis required 
to calculate the optimal time step size and order of accuracy.  
Finally, in Section~\ref{sec:summary}, we end some concluding remarks. 


\section{\label{sec:optimal_time_step_selection} 
         Optimal Time Step (OTS) Selection}
Optimal time step selection is not by itself a method for constructing 
finite difference schemes.  Rather it is a way to enhance to the performance
of existing finite difference schemes by carefully choosing the time step to 
eliminate low-order numerical errors.  The two basic ideas underlying 
optimal time step selection are 
(1) a judicious choice of time step can be used to eliminate the leading-order 
(and possibly higher-order) terms in the error
and
(2) the PDE provides valuable insight into the discretization errors for 
finite difference schemes.
In this section, we present and analyze the technique of optimal time step 
selection for finite difference schemes constructed to solve scalar evolution 
equations of the form 
\beq
  \frac{\partial u}{\partial t} = 
    F\left(x, u(x), D u(x), D^2 u(x), \ldots \right), 
\eeq
where the right hand side is an arbitrary function of the solution $u$, its 
spatial derivatives, and the independent variable $x$.
Because this class of time dependent PDEs is so prevalent and important, 
restricting our attention to problems of this form is not a serious 
limitation.  


\subsection{\label{sec:ots_model_pde} 
            Optimal Time Step for a Model PDE}
Let us begin by considering a finite difference approximation for the
following time dependent PDE in one spatial dimension: 
\beq
  \frac{\partial u}{\partial t} = A \frac{\partial^n u}{\partial x^n},
  \label{eq:model_PDE}
\eeq
where $A$ is a constant of the appropriate sign so that~(\ref{eq:model_PDE}) 
is well-posed.  Because we will be boosting the accuracy of the finite 
difference approximation by optimizing the time step, there is no reason to 
explicitly construct the scheme to be high-order.  In fact, using a high-order 
finite difference scheme only complicates the analysis required to calculate 
the optimal time step.  

To compute the optimal time step, we first analyze the discretization errors 
(both spatial and temporal) for the finite difference approximation, 
explicitly keeping track of the leading-order terms.  In contrast to 
conventional error analysis, we do not sweep all of the errors under big O
notation.  Rather, we take advantage of the fact that derivation of the 
leading-order terms in the error is straightforward for finite difference
schemes through the use of Taylor series expansions.  Because each term in 
the error is proportional to a partial derivative of the solution, we can 
use the PDE to relate the leading-order terms to each other.  
If we have chosen an appropriate finite difference approximation for 
(\ref{eq:model_PDE}), which is relatively straightforward to do, this careful 
analysis yields a direct relationship between the leading-order spatial and 
temporal errors that allows them to be combined as a single term of the form:
\beq
  (L u) P(\dx, \dt) ,
  \label{eq:leading_order_error_model_PDE_general}
\eeq
where $L$ is a differential operator and $P$ is a polynomial in the numerical 
parameters $\dx$ and $\dt$.  By selecting the numerical parameters so that 
$P = 0$, we can completely eliminate the leading-order term in the 
discretization error.  Because time dependent PDEs are often solved by 
stepping in time, it is natural to choose the time step to be a function of 
the grid spacing.  The time step selected in this way is the
\emph{optimal time step} for the finite difference scheme.  Using the optimal
time step for time stepping yields a numerical solution with an order 
of accuracy that is \emph{higher} than the formal order of the original finite 
difference scheme.

An important class of finite difference schemes for time dependent PDEs are 
those based on the method of lines.   When the method of lines approach is 
used for (\ref{eq:model_PDE}), $P$ takes a particularly simple 
form:
\beq
  P(\dx, \dt) = (\alpha \dx^r - \beta \dt^s) \dt,
  \label{eq:leading_order_error_model_PDE_MOL}
\eeq
where $r$ and $(s+1)$ are the orders of the leading spatial and temporal 
discretization errors, and $\alpha$ and $\beta$ are positive constants that 
depend on the details of the PDE and finite difference scheme.  Setting 
$P = 0$, we find that the optimal time step is given by\footnote{The $\dt = 0$ 
root of $P$ is discarded because it is not numerically meaningful.}
\beq
  \dto = \gamma \dx^{r/s},
  \label{eq:optimal_time_step}
\eeq
where $\gamma = (\alpha/\beta)^{1/s}$.  Notice that the optimal time step 
has a similar functional dependence on the grid spacing as a time step that 
satisfies a stability constraint.  


\subsubsection*{\label{sec:error_analysis} 
            Error Analysis}
The form of the local error in 
(\ref{eq:leading_order_error_model_PDE_MOL}) follows from the fact 
that the method of lines first approximates the PDE as a system of ODEs in 
time by only discretizing the spatial derivatives: 
\beq
{\mathbf u}_t = F({\mathbf u}),
\label{eq:method_of_lines}
\eeq
where ${\mathbf u}$ is the vector of values of $u$ at the grid points and
$F({\mathbf u})$ is the finite difference approximation of the spatial 
derivative operator acting on ${\mathbf u}$.  The second term in the local 
error (\ref{eq:leading_order_error_model_PDE_MOL}) arises directly from 
temporal discretization errors associated with the numerical scheme used to 
integrate the system of ODEs in time.  The first term arises because $F$ is 
only an approximation of the spatial derivative operators in the PDE.  As a 
result, the system of ODEs~(\ref{eq:method_of_lines}) has an error due to 
the spatial discretization at \emph{every} point in time.  For a spatial 
discretization error of order $r$, the error in (\ref{eq:method_of_lines}) is 
$O(\dx^r)$, so the error accumulated during each time step due to 
spatial discretization error is $O(\dt \dx^r)$.  Because the method of 
lines is so frequently used to construct finite difference approximations for 
time dependent PDEs, we will focus solely on finite difference schemes of this 
type for the remainder of the paper.  It is straightforward to extend the 
results we obtain to more general finite difference schemes. 

To analyze the accuracy of the finite difference scheme 
for~(\ref{eq:model_PDE}) when the optimal time step is used, we examine the 
higher-order terms in the discretization error.  Elimination of the leading 
terms in the discretization error leaves a local error of the form 
$O(\dt \dx^p) + O(\dt^{q+1})$, where $p>r$ and $(q+1) > (s+1)$ are the orders 
of the spatial and temporal discretization errors, respectively, after the 
leading-order terms in the error have been eliminated.  
From the local error, we can compute the global error of the numerical 
solution over extended intervals of time by using the heuristic 
argument that the global error is equal to the local error divided by 
$\dt$~\cite{gko_book}:
\beq
e = O(\dx^p) + O(\dt^q).
\label{eq:global_error_ots}
\eeq
Thus, because $p > r$ and $q > s$, we see that using an optimal time step 
boosts the overall accuracy of the finite difference scheme.

It is important to emphasize that $\dx$ and $\dt$ are \emph{not} independent 
in~(\ref{eq:global_error_ots}) because the time step must be set to $\dto$ 
in order to derive the error estimate.  In other words, there is really only 
one parameter, $\dx$, that controls the numerical accuracy of the finite 
difference scheme (see Appendix~\ref{app:formal_vs_practical_accuracy} for 
further discussion about this important point).  Since $\dto = O(\dx^{r/s})$, 
the global error (\ref{eq:global_error_ots}) reduces to
\beq
e = O \left( \dx^{\min(p,rq/s)} \right).
\label{eq:global_error_ots_simplified}
\eeq


\subsubsection*{Stability Considerations}
Thus far, we have not considered the issue of numerical stability of finite
difference schemes when the time step is set to $\dto$.  For explicit time 
integration schemes, OTS selection is ineffective when the optimal time step 
is greater than the smallest stable time step.  In this situation, we can 
switch to an implicit or semi-implicit time integration scheme with the 
same order of accuracy for which the optimal time step is stable.  
While the need to shift to implicit or semi-implicit time integration results 
in a more complicated finite difference scheme, OTS selection is still 
beneficial because it allows us to extract more accuracy from the simplest, 
low-order implicit or semi-implicit methods.
Note that a new optimal time step may need to be calculated for the modified 
finite difference scheme.


\subsubsection*{\label{sec:computational_performance} 
                Computational Performance}
For many problems, the optimal time step is on the order of the maximum 
time step allowed by the stability constraint for an explicit method.  
As a result, using the optimal time step to advance the finite
difference scheme in time may appear to be overly restrictive and lead to poor 
computational performance.  However, this apparent drawback is more than 
compensated by the boost in the order of accuracy.  For example, when solving 
the 1D diffusion equation using a forward Euler time integration scheme with a 
second-order central difference stencil for the Laplacian, we obtain a 
fourth-order scheme when $\dt$ is set equal to the optimal time step 
(discussed further in Sections~\ref{sec:diffusion_eqn_1d} and
\ref{sec:diffusion_eqn_2d}).  
As Table~\ref{tab:comp_perf_vs_err} shows, this boost in accuracy leads to a
scheme that is computationally cheaper than traditional methods that use 
the same low-order finite difference stencils.  The performance gain for 
problems in higher spatial dimensions is even more impressive.  As we can see 
in Table~\ref{tab:comp_perf_vs_dim}, the gap between the performance of a
simple forward Euler scheme with the optimal time step and the Crank-Nicholson
method grows with the spatial dimension of the problem.  

\begin{table}[tb]
\caption{
Computational cost of various finite difference schemes for the 1D 
diffusion equation as a function of the global numerical error $e$.
For all of the schemes, the standard second-order central difference 
stencil is used to discretize the Laplacian.  
Note that the time step for the backward Euler scheme is chosen so that the
temporal error is subdominant to the spatial error and that the computation 
time for the Crank-Nicholson method assumes an $O(N) = O \left( 1/\dx\right)$ 
matrix inversion algorithm. 
}
\label{tab:comp_perf_vs_err} 
\renewcommand{\arraystretch}{1.5}
\begin{tabular}{lcccc}
  \hline
  {\bf Numerical Scheme} & $\dx$ 
  & $\dt$
  & {\bf Memory}
  & {\bf Compute Time}
  \\
  \hline 
  Forward Euler    & $O\left( e^{1/2} \right)$ 
                   & $O\left( e \right)$ 
                   & $O\left( e^{-1/2} \right)$ 
                   & $O\left( e^{-3/2} \right)$ \\
  Backward Euler   & $O\left( e^{1/2} \right)$ 
                   & $O\left( e \right)$ 
                   & $O\left( e^{-1/2} \right)$ 
                   & $O\left( e^{-3/2} \right)$ \\
  Crank-Nicholson  & $O\left( e^{1/2} \right)$ 
                   & $O\left( e^{1/2} \right)$ 
                   & $O\left( e^{-1/2} \right)$ 
                   & $O\left( e^{-1} \right)$ \\
  Forward Euler with OTS  & $O\left( e^{1/4} \right)$ 
                   & $O\left( e^{1/2} \right)$ 
                   & $O\left( e^{-1/4} \right)$ 
                   & $O\left( e^{-3/4} \right)$ \\ 
  \hline
\end{tabular}
\end{table}

\begin{table}[tb]
\caption{
Computational cost of the forward Euler scheme with optimal time step and 
the Crank-Nicholson method for solving the diffusion equation as a function 
of the global numerical error $e$.
For both schemes, second-order, isotropic stencils are used to discretize 
the Laplacian.  
Note that the computation time for the Crank-Nicholson method assumes an 
$O(N) = O \left( 1/\dx^d \right)$ matrix inversion algorithm 
and that the optimal time step for the forward Euler scheme is $\dto = \dx^2/6$.
}
\label{tab:comp_perf_vs_dim}
\renewcommand{\arraystretch}{1.5}
\begin{tabular}{ccccc}
  \hline
  & \multicolumn{2}{c}{\bf Forward Euler with OTS} 
  & \multicolumn{2}{c}{\bf Crank-Nicholson} \\
  \cline{2-3} \cline{4-5} 
    {\bf Dimensions} & {\bf Memory} & {\bf Compute Time} 
  & {\bf Memory} & {\bf Compute Time} \\
  \hline 
  $1$ & $O\left( e^{-1/4} \right)$ 
      & $O\left( e^{-3/4} \right)$ 
      & $O\left( e^{-1/2} \right)$ 
      & $O\left( e^{-1} \right)$ \\ 
  $2$ & $O\left( e^{-1/2} \right)$ 
      & $O\left( e^{-1} \right)$ 
      & $O\left( e^{-1} \right)$ 
      & $O\left( e^{-3/2} \right)$ \\ 
  $3$ & $O\left( e^{-3/4} \right)$ 
      & $O\left( e^{-5/4} \right)$ 
      & $O\left( e^{-3/2} \right)$ 
      & $O\left( e^{-2} \right)$ \\
  $d$ & $O\left( e^{-d/4} \right)$ 
      & $O\left( e^{-(d+2)/4} \right)$ 
      & $O\left( e^{-d/2} \right)$ 
      & $O\left( e^{-(d+1)/2} \right)$ \\ 
  \hline 
\end{tabular}
\end{table}



\subsection{\label{sec:ots_general_1d_pdes} 
            OTS Selection for General PDEs in One Space Dimension} 
In the previous section, we analyzed optimal time step selection in the 
context of a simple model PDE in one space dimension.  For more general PDEs, 
OTS selection continues to be useful, but it needs to be augmented with 
correction terms to achieve the same improvement in the order of accuracy.  
In this section, we discuss these correction terms in the context of general 
constant coefficient, linear PDEs and semilinear PDEs. 


\subsubsection*{\label{sec:ots_linear_pde} 
            General Constant Coefficient, Linear PDEs} 
Let us consider a general constant coefficient, linear PDE of the form
\beq
  \frac{\partial u}{\partial t} = 
  \sum_{k=1}^n A_k \frac{\partial^k u}{\partial x^k} + f(x,t)
  \label{eq:linear_PDE}.
\eeq
Even if we use the PDE to relate terms in the discretization error, it is
unlikely that all of the dominant terms in the error can be combined into 
a single term.   As a result, the leading-order discretization error is
generally a sum of several terms:
\beq
  \dt\left[ (L u) (\alpha \dx^r - \beta \dt^s) 
  + \sum_k (L_k u) \dx^r 
  + \sum_k (L'_k u) \dt^s 
  + (G f) \dt^s \right]
  \label{eq:leading_order_error_linear_PDE_MOL}
\eeq
where $L$, $u$, $\alpha$, $\beta,$ $r$, and $s$ are defined as in
(\ref{eq:leading_order_error_model_PDE_general}) and
(\ref{eq:leading_order_error_model_PDE_MOL}), 
$L_k$ and $L'_k$ are the linear spatial differential operators associated 
with the leading-order terms in the discretization error that are not involved 
in the choice of the optimal time step, and $G$ is a spatio-temporal 
differential operator that acts on the source term $f$.  
Note that neither $L_k$ nor $L'_k$ involve any temporal differential 
operators because any that arise can be eliminated using the 
PDE~(\ref{eq:linear_PDE}).  

From~(\ref{eq:leading_order_error_linear_PDE_MOL}), it is clear that setting 
$\dt = \dto$ is not enough to completely eliminate the 
leading-order error.  To eliminate the vestigial errors, we need to add 
correction terms to cancel out the second, third, and fourth terms in 
(\ref{eq:leading_order_error_linear_PDE_MOL}).  At each time step, the second 
and third terms in (\ref{eq:leading_order_error_linear_PDE_MOL}) can be 
approximated using finite differences applied to the solution $u$ at the 
current time.
The last term can be computed using either a finite difference approximation 
or a direct analytic calculation.  With the addition of these correction 
terms, the global error can be determined using the analysis in 
Section~\ref{sec:error_analysis}.

Some care must be exercised when choosing the finite difference 
stencils for the correction terms.  While the order of accuracy will always
be boosted, the finite difference stencils used for the correction terms
can introduce errors into the numerical solution that will cause the order
of accuracy to fall below the estimate given by 
(\ref{eq:global_error_ots_simplified}).


\subsubsection*{Semilinear PDEs}
Optimal time step selection can also be applied to semilinear PDEs of the
form
\beq
  \frac{\partial u}{\partial t} = A(x,t) \frac{\partial^n u}{\partial x^n}
  + F \left( \frac{\partial^{n-1} u}{\partial x^{n-1}},
      \frac{\partial^{n-2} u}{\partial x^{n-2}}, \ldots,
      \frac{\partial u}{\partial x}, u \right)
  + f(x,t)
  \label{eq:semilinear_PDE}
\eeq
where $F$ is an arbitrary function of the lower-order spatial derivatives
of $u$ and $f(x,t)$ is a source term.  While the coefficient on the 
leading-order spatial derivative is generally allowed to be a function of 
space and time, optimal time step selection can only be applied to PDEs where
$A(x,t)$ is a constant.  Because the PDE is linear in the leading-order 
spatial derivative, it is natural to construct a finite difference scheme that 
treats $F$ in an explicit manner and lets stability considerations determine 
whether the $A \frac{\partial^n u}{\partial x^n}$ term is handled explicitly 
or implicitly.  Assuming that sufficiently high-order stencils are used to 
compute $F$, the leading-order discretization error for such a finite 
difference scheme is given by
\beq
  \dt \left[ (L u) (\alpha \dx^r - \beta \dt^s) 
  + \left( H u \right) \dx^r 
  + \left( H' u \right) \dt^s
  + (G f) \dt^s \right]
  \label{eq:leading_order_error_semilinear_PDE_MOL}
\eeq
where $L$, $u$, $\alpha$, $\beta,$ $r$, and $s$ are defined as in
(\ref{eq:leading_order_error_model_PDE_general}) and
(\ref{eq:leading_order_error_model_PDE_MOL}), $H$ and $H'$ are spatial 
differential operators (potentially nonlinear) associated with the 
leading-order terms in the discretization error that arise from the nonlinear 
term in~(\ref{eq:semilinear_PDE}), and $G$ is a spatio-temporal differential 
operator that acts on $f$.  With the discretization error written in the 
form (\ref{eq:leading_order_error_semilinear_PDE_MOL}), the optimal time 
step and correction terms can be derived by proceeding in the same manner 
as in the previous section.


\subsection{Boundary Conditions}
In general, high-order discretizations of boundary conditions are required 
to ensure that errors introduced at the domain boundary do not pollute 
the numerical solution in the domain interior.  For Dirichlet boundaries, 
it is sufficient to impose boundary conditions by using boundary values 
that have the same order of accuracy as the solution.  More effort is 
required to ensure that Neumann boundary conditions do not reduce the order 
of accuracy of the solution.  In general, Neumann boundary conditions require 
that the accuracy of ghost cells slightly exceeds the desired order of 
accuracy for the solution.  A detailed discussion of methods for imposing 
boundary conditions is beyond the scope of this paper.  We refer interested 
readers to the thorough analysis presented in~\cite{gko_book}.  To avoid 
complicating the discussion in Sections~\ref{sec:applications_1d} 
and~\ref{sec:applications_multidim}, Neumann boundary conditions for
all examples are imposed by taking advantage of knowledge of the analytical 
solution.


\subsection{\label{sec:ots_higher_spatial_dims}
            OTS Selection in Multiple Space Dimensions}
Optimal time step selection is applicable to PDEs in any number of space
dimensions.  While problems in higher dimensions generally require a more 
careful choice of the finite difference stencil used to approximate spatial 
derivatives, there are no fundamental barriers that prevent the use of optimal 
time step selection.  Moreover, by using a `ghost cell' or `ghost value' 
method for imposing boundary 
conditions~\cite{gibou_2005,ito_2005,fedkiw_1999,osher_fedkiw_book},
optimal time step selection can even be directly applied to problems on 
irregular domains.  

One important issue that arises in multiple space dimensions is the choice
of grid spacing.  In general, the grid spacing need not be equal in all 
spatial directions.  For some problems, the ratio of the grid spacing in
different coordinate directions may need to be carefully chosen for an 
optimal time step to exist.  In other words, it may be necessary to optimally 
choose both the time step \emph{and} the mesh in order to boost the order 
of accuracy.


\subsection{Limitations of Optimal Time Step Selection}
As with any numerical method, optimal time step selection has its limitations.
The most serious limitation is the requirement that the coefficient on the 
leading-order spatial derivative in the PDE be constant in time and space.  
Without this assumption, the first term in the leading-order discretization 
error would be of the form 
$(L u) (\alpha(x,t) \dx^r - \beta(x,t) \dt^s) \dt$,
where $\alpha$ and $\beta$ are now functions of space and time.  This
small change in the form of the error makes it impossible to derive a single 
optimal time step.  Instead, each grid point would possess its own individual 
optimal time step.  For a similar reason, optimal time step selection also 
fails for quasilinear and fully nonlinear PDEs.  The issue for these types of 
PDEs is that the coefficients in $P(\dx, \dt)$ become functions of the 
solution $u$.

Another limitation of optimal time step selection is that it does not,
in its current incarnation, apply to finite difference schemes for general
systems of PDEs.  The main issue here is that each PDE might have its 
own optimal time step.  OTS is, however, certainly applicable for problems 
where the optimal time step is the same for all of the individual PDEs in the 
system.


\section{\label{sec:applications_1d} 
         Application to PDEs in One Space Dimension}
Because there are no geometry or anisotropy considerations, optimal time step 
selection is very useful for boosting the accuracy of many finite difference 
schemes in one spatial dimension.  In this section, we demonstrate its 
utility in designing finite difference schemes to solve several classical 
linear and semilinear PDEs.  The examples in this section were selected 
because they have analytical solutions that are useful to compare numerical 
solutions against.  However, the utility of OTS selection is by no means 
limited to these simple PDEs.


\subsection{Linear Advection Equation}
For our first application of optimal time step selection, we consider 
a finite difference scheme for the linear advection equation
~\cite{gko_book,leveque_book_1992,leveque_book_2002}:
\beq
  \frac{\partial u}{\partial t} + A \frac{\partial u}{\partial x} = 0,
  \label{eq:advection_eqn_1d}
\eeq
where $A$ is the flow speed, which we take to be positive for convenience.  
For an initial condition of the form $u(x,0) = f(x)$, the analytical solution 
is $f(x-At)$.  While it is unlikely that one would actually use a numerical 
method to solve~(\ref{eq:advection_eqn_1d}), it is an interesting example 
where optimal time step selection dramatically improves the accuracy of the 
numerical solution. 

Perhaps the simplest, stable finite difference scheme 
for (\ref{eq:advection_eqn_1d}) uses forward Euler for time integration 
scheme and a first-order upwind discretization for the spatial derivative:
\beq
  u^{n+1}_j = u^{n}_j 
  - A \dt \left( \frac{u^{n}_j - u^{n}_{j-1}}{\dx} \right).
  \label{eq:advection_eqn_1d_FD_scheme}
\eeq
This scheme is formally first-order in both space and time.  

To compute the optimal time step, we begin by analyzing the discretization
error for~(\ref{eq:advection_eqn_1d_FD_scheme}).  In general, we only need to 
keep track of the leading-order terms in the discretization error.  However,
for the advection equation, it is valuable to retain all of them.  
Using Taylor series expansions of the true solution of the PDE, we find that 
\bea
  \tu^{n+1}_j &=& \tu^{n}_j 
  + \sum_{k=1}^\infty \frac{\dt^k}{k!} 
       \frac{\partial^k \tu^n}{\pt^k} 
  = \tu^{n}_j + \sum_{k=1}^\infty \frac{\left( -A \dt \right)^k}{k!} 
       \frac{\partial^k \tu^n}{\px^k},
  \label{eq:advection_eqn_1d_time_err} 
  \\
  \frac{\tu^{n}_j - \tu^{n}_{j-1}}{\dx} &=& 
  \frac{\partial \tu^n}{\px} 
  - \frac{1}{\dx} \sum_{k=2}^\infty \frac{\left( -\dx \right)^k}{k!} 
       \frac{\partial^k \tu^n}{\px^k}.
  \label{eq:advection_eqn_1d_space_err}
\eea
where $\tu$ denotes the true solution of the PDE, all derivatives are 
evaluated at $x_j$, and we have used the 
PDE~(\ref{eq:advection_eqn_1d_FD_scheme}) to replace all of the time 
derivatives with spatial derivatives in (\ref{eq:advection_eqn_1d_time_err}).
For convenience, we will continue to suppress the subscripts on spatial
derivatives throughout the paper; the location where they should be 
evaluated will be apparent from the context.

Combining~(\ref{eq:advection_eqn_1d_time_err}) 
and~(\ref{eq:advection_eqn_1d_space_err}) with the finite difference 
scheme~(\ref{eq:advection_eqn_1d_FD_scheme}) yields the evolution
equation for the error $e \equiv u - \tu$:
\beq
  e^{n+1}_j = e^{n}_j 
    - A \dt \left( \frac{e^{n}_j - e^{n}_{j-1}}{\dx} \right) 
    + A \dt \sum_{k=2}^\infty \frac{\left( -1 \right)^k}{k!} 
        \frac{\partial^k \tu^n}{\px^k} 
        \left( \dx^{k-1} - \left( A \dt \right)^{k-1} \right).
  \label{eq:advection_eqn_1d_err_eqn}
\eeq
Therefore, the leading-order term of the discretization error is given
by
\beq
  \left( \frac{A}{2} \frac{\partial^2 \tu^n}{\px^2} \right)
  \left( \dx - A \dt \right) \dt,
\eeq
which leads to an optimal time step of $\Delta t_{opt} = \Delta x / A$.

For the linear advection equation, setting the time step equal to the optimal 
time step has an amazing consequence -- not only does the leading-order term
in the discretization error vanish, the \emph{entire} local truncation 
error at each time step is completely eliminated!  In other words, the error 
in the numerical solution is due solely to errors in the initial conditions.
Assuming that the initial conditions are set exactly, there is absolutely no 
error in the numerical solution for all times.
This result, which is unique to the advection equation, is well-known in the 
numerical analysis and scientific computing community as the unit CFL 
condition~\cite{leveque_book_2002} and is usually proved by examining 
how characteristic lines of the advection equation pass through grid points.  
It is interesting to see that it also naturally arises through optimal time 
step selection.


\subsection{Diffusion Equation \label{sec:diffusion_eqn_1d}}
As an example where optimal time step selection yields a more typical boost 
in the order of accuracy, let us consider the diffusion equation:
\beq
  \frac{\partial u}{\pt} = D \frac{\partial^2 u}{\px^2} + f(x,t),
  \label{eq:diffusion_eqn_1d}
\eeq
where $D$ is the diffusion constant and $f(x,t)$ is a source term.  
We apply optimal time step selection to the simplest finite difference 
scheme for (\ref{eq:diffusion_eqn_1d}):
\beq
  u^{n+1}_j = u^{n}_j 
  + \dt 
    \left( D \left[\frac{u^{n}_{j+1} -2 u^{n}_j + u^{n}_{j-1}}{\dx^2}\right] 
         + f^n_j \right),
  \label{eq:diffusion_eqn_1d_FD_scheme}
\eeq
which uses forward Euler for time integration and the standard second-order 
central difference approximation for the Laplacian.
This scheme is formally first-order in time and second-order in space.  
The stability constraint $\dt \le \dx^2/2D$ implies that the scheme is 
$O(\dx^2)$ accurate overall.

\begin{figure}[tb]
\begin{center}
\scalebox{0.35}{\includegraphics{figures/diffusion_eqn_1d_no_src_error_vs_N}} 
\caption{$L^\infty$ error as a function of number of grid points for three 
finite difference schemes that solve the 1D diffusion equation: forward Euler 
with optimal time step (circles), forward Euler with suboptimal time step
(squares), and Crank-Nicholson (diamonds).  
All three schemes use the standard second-order, central finite difference 
approximation for the Laplacian.  
}
\label{fig:diffusion_eqn_1d_no_src_error}
\end{center}
\end{figure}

As before, we begin by analyzing the leading-order terms of the 
discretization error for the finite difference scheme.  Employing Taylor
series expansions and the PDE (\ref{eq:diffusion_eqn_1d}),
we find that the true solution satisfies
\bea
  \tu^{n+1}_j = \tu^{n}_j 
  &+& \dt \left( D \frac{\partial^2 \tu^n}{\px^2} + f^n_j \right)
  \nonumber \\
  &+& \frac{(D\dt)^2}{2} \frac{\partial^4 \tu^n}{\px^4} 
  + \frac{\dt^2}{2} \left( D\frac{\partial^2 f}{\px^2}
                         + \frac{\partial f}{\pt} \right)
  + O \left( \dt^3 \right)
  \label{eq:diffusion_eqn_1d_time_err} 
\eea
and that the central difference approximation for the Laplacian satisfies
\beq
  \frac{\tu^{n}_{j+1} -2 \tu^{n}_j + \tu^{n}_{j-1}}{\dx^2}  =
  \frac{\partial^2 \tu^n}{\px^2} 
  + \frac{\dx^2}{12} \frac{\partial^4 \tu^n}{\px^4} 
  + O(\dx^4)
  \label{eq:diffusion_eqn_1d_space_err}
\eeq
Therefore, the truncation error for (\ref{eq:diffusion_eqn_1d_FD_scheme})
is given by
\beq
  \frac{\partial^4 \tu^n}{\px^4} 
    \left[ \frac{\dx^2}{12} - \frac{D \dt}{2} \right] (D \dt)
    - \frac{\dt^2}{2} \left( D \frac{\partial^2 f}{\px^2} 
                           + \frac{\partial f}{\pt} \right)
      + O(\dt \dx^4) + O(\dt^3).
  \label{eq:diffusion_eqn_1d_trunc_err}
\eeq
From this expression, it is easy to see that the optimal time step is 
$\dto = \dx^2/6D$ and that the correction term is
\beq
\frac{\dt^2}{2} \left( D \frac{\partial^2 f}{\px^2} 
                     + \frac{\partial f}{\pt} \right).
\eeq
From (\ref{eq:global_error_ots_simplified}), we see that using the optimal 
time step and adding this simple correction term to 
(\ref{eq:diffusion_eqn_1d_FD_scheme}) boosts the accuracy of original scheme 
from second to fourth order.  Note that to achieve fourth order accuracy, 
the spatial derivatives in the correction term must be calculated using a
finite difference approximation that is at least second-order accurate; 
otherwise, the truncation error will be $O(\dt^2 \dx)$ which implies an 
$O(\dt \dx) = O(\dx^3)$ global error. 

To demonstrate the improvement in accuracy of the forward Euler scheme when 
the optimal time step is used, we compare the numerical errors of three finite 
difference schemes for the diffusion equation: forward Euler with optimal
time step and correction term, forward Euler with a suboptimal time step, and 
Crank-Nicholson.  As we can see in 
Figure~\ref{fig:diffusion_eqn_1d_no_src_error}, forward Euler with optimal 
time step is fourth-order accurate while both forward Euler with a suboptimal 
time step and Crank-Nicholson are only second-order accurate.  
Using the forward Euler scheme with an optimal time step and correction term 
has a clear advantage over the other finite difference schemes.  Even with as 
few as 25 grid points, the error in solution computed by the forward Euler 
scheme with an optimal time step and correction term is orders of magnitude 
smaller. 

The importance of the correction term is illustrated in 
Figure~\ref{fig:diffusion_eqn_1d_src_error}, which compares the accuracy of 
the OTS forward Euler scheme with and without the correction term.  As we 
can see, OTS forward Euler with correction term is fourth-order accurate 
while OTS forward Euler without correction term is only second-order 
accurate.  

\begin{figure}[tb]
\begin{center}
\scalebox{0.35}{\includegraphics{figures/diffusion_eqn_1d_src_error_vs_N}} 
\caption{$L^\infty$ error as a function of number of grid points for 
two finite difference schemes that solve the diffusion equation: 
forward Euler with optimal time step and correction term (circles) and 
forward Euler with optimal time step \emph{without} correction term 
(triangles).  Both schemes use the standard second-order, central finite 
difference approximation for the Laplacian.
}
\label{fig:diffusion_eqn_1d_src_error}
\end{center}
\end{figure}

As mentioned in Section~\ref{sec:computational_performance}, one of the 
advantages of using optimal time step selection is the superior scaling of 
the computational cost with respect to the numerical error.  
Another way to achieve computational performance with the same scaling would 
be to use a Crank-Nicholson time integration scheme with a fourth-order 
discretization of the Laplacian~\cite{gibou_2005}.  By using an 
$O\left(\dx^2 \right)$ time step and a linear solver that scales linearly 
with the size of the matrix, we achieve an overall fourth-order accurate 
method that has the same computational complexity as the forward Euler scheme
described above with an optimal time step.  However, the forward Euler scheme 
with optimal time step will still outperform the Crank-Nicholson scheme 
because the latter requires the use of a wider stencil and the solution of 
at least one linear system of equation for each time step.  Round-off error
associated with matrix inversion may also be an issue for the Crank-Nicholson 
method.


\subsection{Viscous Burgers Equation}
We now demonstrate the use of optimal time step selection in the context of 
a well-known semilinear PDE -- the viscous Burgers 
equation~\cite{whitham_book}:
\beq
  \frac{\partial u}{\pt} + u \frac{\partial u}{\px} = 
     \nu \frac{\partial^2 u}{\px^2} 
  \label{eq:burgers_1d}
\eeq
where $\nu$ is the viscosity.  For this equation, let us consider the finite
difference scheme constructed using a forward Euler time integration scheme
and second-order, central difference approximations for the diffusion and 
nonlinear advection terms:
\beq
  u^{n+1}_j = u^{n}_j 
  + \dt 
    \left( \nu 
      \left [ \frac{u^{n}_{j+1} -2 u^{n}_j + u^{n}_{j-1}}{\dx^2} \right]
         - u^n_j 
      \left[ \frac{u^{n}_{j+1} - u^{n}_{j-1}}{2 \dx} \right] 
    \right).
  \label{eq:burgers_1d_FD_scheme}
\eeq
This scheme is formally first-order in time and second-order in space.  
Using the stability condition for the advection-diffusion as a heuristic 
guide\footnote{The stability constraint for the advection-diffusion equation
is $\dt < \min \{2D/A^2, \dx^2/2D \}$~\cite{chan_1984}.}, 
we expect a stability constraint of the form $\dt \le \dx^2/2 \nu$ in the 
limit $\dx \rightarrow 0$ (assuming that the solution $u$ remains bounded).  
Therefore, the scheme (\ref{eq:burgers_1d_FD_scheme}) is $O(\dx^2)$ accurate 
overall. 

\begin{figure}[tb]
\begin{center}
\scalebox{0.35}{\includegraphics{figures/burgers_eqn_1d_error_vs_N}} 
\caption{$L^\infty$ error as a function of number of grid points for
two finite difference schemes that solve the viscous Burgers equation:
forward Euler with optimal time step and correction term (circles)
and forward Euler with suboptimal time step $\dt = \dx^2/4\nu$ and no 
correction term (squares).
Both schemes use second-order, central finite difference approximations for
the advection and diffusion terms.
The viscous Burgers equation is solved to time $t=2$ on the domain 
$0 < x < 10$ with the viscosity $\nu$ set to $0.1$.  The initial conditions are 
taken to be 
$u(x,0) = 1 + \gamma \sqrt{\frac{\nu}{\pi}} \exp\left( -(x-1)^2/4 \nu \right) 
            / \left[ 1 + \frac{\gamma}{2} \ 
                         \mathtt{erfc}\left((x-1)/\sqrt{4\nu} \right) 
    \right]$,
where $\ln(1+\gamma)$ is the effective Reynolds number (set equal to 10) and 
the wave speed is set equal to $1$.  The boundary conditions are imposed 
exactly by using
the analytical solution
$u(x,t) = 1 + \gamma \sqrt{\frac{\nu}{\pi T}} 
              \exp\left( -(x-T)^2/4 \nu T \right) 
            / \left[ 1 + \frac{\gamma}{2} \ 
                         \mathtt{erfc}\left((x-T)/\sqrt{4\nu T} \right) 
    \right]$,
where $T = t+1$.
}
\label{fig:burgers_1d_error}
\end{center}
\end{figure}

\begin{figure}[tb]
\begin{center}
\scalebox{0.32}{\includegraphics{figures/burgers_eqn_1d_FE_OTS_soln}} 
\ \ \ \ \ 
\scalebox{0.32}{\includegraphics{figures/burgers_eqn_1d_FE_soln}} 
\caption{Comparison of numerical solutions for the 1D viscous Burgers 
equation~(\ref{eq:burgers_1d}) using forward Euler time stepping with 
optimal time step and correction term (left) and forward Euler time 
stepping with suboptimal time step $\dt = \dx^2/4 \nu$ (right).  
Both figures compare the analytical solution (solid line) at $t = 2$ on the 
domain $0 < x < 10$ with the numerical solution (circles) computed using 
$100$ grid points.  
For information about the initial/boundary conditions and physical parameters 
used to compute these solutions, see the caption for 
Figure~\ref{fig:burgers_1d_error}. 
}
\label{fig:burgers_1d_solns}
\end{center}
\end{figure}

To analyze the discretization error for (\ref{eq:burgers_1d_FD_scheme}), 
we combine~(\ref{eq:diffusion_eqn_1d_space_err}) from our analysis of 
the diffusion equation with the leading-order discretization error for 
the central difference approximation of $u_x$,
\beq
  \frac{\tu^{n}_{j+1} - \tu^{n}_{j-1}}{2 \dx}  =
  \frac{\partial \tu^n}{\px} 
  + \frac{\dx^2}{6} \frac{\partial^3 \tu^n}{\px^3} 
  + O(\dx^4),
  \label{eq:burgers_1d_ux_err}
\eeq
and the Burgers equation analogue of (\ref{eq:diffusion_eqn_1d_time_err}),
\bea
  \tu^{n+1}_j = \tu^{n}_j 
    &+& \dt \left( \nu \frac{\partial^2 \tu^n}{\px^2} 
                 - \tu^{n}_j \frac{\partial \tu^n}{\px} \right)
    \nonumber \\
    &+& \frac{\dt^2}{2} 
        \left( \nu^2 \frac{\partial^4 \tu^n}{\px^4} 
             - 2 \nu \tu^n_j\frac{\partial^3 \tu^n}{\px^3} 
             - 4 \frac{\partial \tu^n}{\px} \frac{\partial^2 \tu^n}{\px^2} 
             + 2 \tu^n_j \left(\frac{\partial \tu^n}{\px} \right)^2
             + \left(\tu^n_j\right)^2 \frac{\partial^2 \tu^n}{\px^2} 
        \right) 
    \nonumber \\
    &+& O \left( \dt^3 \right).
    \label{eq:burgers_1d_time_err}
\eea
Together these imply that the leading order term in the local truncation error 
for~(\ref{eq:burgers_1d_FD_scheme}) is given by
\bea
  \tau^n_j &=&
      \left( \nu \frac{\partial^4 \tu^n}{\px^4} 
           - 2 \tu^n_j \frac{\partial^3 \tu^n}{\px^3} \right)
      \left[ \frac{\dx^2}{12} - \frac{\nu \dt}{2}  \right] \dt
  \nonumber \\
  &+& \frac{\dt^2}{2} 
      \left( 
           4 \nu \frac{\partial \tu^n}{\px} \frac{\partial^2 \tu^n}{\px^2}
         - 2 \tu^n_j \left( \frac{\partial^2 \tu^n}{\px^2} \right)^2
         - \left(\tu^n_j\right)^2 \frac{\partial^2 \tu^n}{\px^2}
      \right)
  \label{eq:burgers_1d_err_eqn}
\eea
Therefore, the optimal time step is $\dto = \dx^2/6D$ and the correction term 
is
\beq
  - \frac{\dt^2}{2} 
      \left( 
           4 \nu \frac{\partial \tu^n}{\px} \frac{\partial^2 \tu^n}{\px^2}
         - 2 \tu^n_j \left( \frac{\partial^2 \tu^n}{\px^2} \right)^2
         - \left(\tu^n_j\right)^2 \frac{\partial^2 \tu^n}{\px^2}
      \right)
  \label{eq:burgers_1d_corr_term}
\eeq 
By using the optimal time step and the correction term, the overall error
for the finite difference scheme~(\ref{eq:burgers_1d_FD_scheme}) is reduced
from $O(\dx^2)$ to $O(\dx^4)$.  As for the diffusion equation, we need
to use a second-order accurate discretization for the spatial derivatives
in the correction term.  
Figures~\ref{fig:burgers_1d_error} and \ref{fig:burgers_1d_solns} demonstrate 
the boost in accuracy obtained by using the optimal time step and adding the
correction term to the finite difference 
scheme~(\ref{eq:burgers_1d_FD_scheme}).

The Burgers equation example illustrates an important aspect of optimal time 
step selection: the ease with which OTS selection can be used to boost the 
order of accuracy depends on the choice of the finite difference scheme.  
Had we chosen an upwind approximation for the gradient term in the Burgers 
equation, the correction term would have been more complicated and included 
terms involving higher-order spatial derivatives than those that appear in the
original equation.  While it should be possible to handle this situation with 
OTS selection, it is clearly less desirable.


\subsection{Fourth-Order Parabolic Equation}
As a final example in one space dimension, we consider a PDE with high-order
spatial derivatives -- a fourth-order parabolic equation: 
\beq
  \frac{\partial u}{\pt} = -\kappa \frac{\partial^4 u}{\px^4} + f(x,t), 
  \label{eq:4th_order_parabolic_eqn_1d}
\eeq
where $\kappa > 0$.  This example illustrates the importance of the choice of
discretization for the spatial derivative on the applicability of OTS selection.

From our previous examples, we know that optimal time step selection requires 
the coefficient on leading-order spatial discretization error to be directly 
related to the second derivative of the solution $u$ with respect to time.  
From~(\ref{eq:4th_order_parabolic_eqn_1d}), we see that 
\beq
  \frac{\partial^2 u}{\pt^2} = 
    \kappa^2 \frac{\partial^8 u}{\px^8} 
  - \kappa \frac{\partial^4 f}{\px^4} 
  + \frac{\partial f}{\pt}
  \label{eq:4th_order_parabolic_eqn_1d_second_time_derivative},
\eeq
which indicates that the leading-order term in the spatial discretization 
error should involve the eighth-derivative of $u$.  In other words, the
finite difference approximation to the bilaplacian needs to be at least 
fourth-order accurate.  With this insight, let us consider a finite 
difference scheme for~(\ref{eq:4th_order_parabolic_eqn_1d}) that 
uses forward Euler for time integration and a fourth-order central 
difference approximation for the bilaplacian:
\beq
  u^{n+1}_j = u^{n}_j + \dt \left( -\kappa B u^n + f_j^n \right), 
  \label{eq:4th_order_parabolic_eqn_1d_FD_scheme}
\eeq
where the fourth-order discrete bilaplacian is given by
\beq
  B u^n = \frac{ -u^{n}_{j+3} + 12 u^{n}_{j+2} - 39 u^{n}_{j+1}
               + 56 u^{n}_j
               - 39 u^{n}_{j-1} + 12 u^{n}_{j-2} -u^{n}_{j-3} }
               {6 \dx^4}.
\eeq
This scheme is formally first-order in time and fourth-order in space.  
Due to the stability constraint $\dt \le 3\dx^4/40 \kappa$, the scheme is 
$O(\dx^4)$ accurate overall.

\begin{figure}[tb]
\begin{center}
\scalebox{0.33}{
  \includegraphics{figures/4th_order_parabolic_eqn_1d_error_vs_N}} 
\ \ 
\scalebox{0.33}{
  \includegraphics{figures/4th_order_parabolic_eqn_1d_error_vs_N_roundoff}} 
\caption{$L^\infty$ error as a function of number of grid points for four
finite difference schemes that solve the fourth-order parabolic equation
(\ref{eq:4th_order_parabolic_eqn_1d}):
forward Euler with optimal time step and correction term (circles),
forward Euler with suboptimal time step and no correction term (squares),
Crank-Nicholson with a second-order stencil for the bilaplacian (diamonds), 
and Crank-Nicholson with a fourth-order stencil for the bilaplacian and
an $O(\dx^2)$ time step (triangles).
Both forward Euler schemes use a fourth-order, central finite difference 
approximation for the bilaplacian.  The boundary and ghost cells values
are set by taking values from the known analytical solution.
Note that the errors for the forward Euler with suboptimal time step and 
fourth-order Crank-Nicholson schemes lie almost directly on top of each 
other at the resolution of the figures.  
The figure on the left highlights the impact of round-off error associated 
with matrix inversion on the accuracy of the solution for the two 
Crank-Nicholson schemes.
}
\label{fig:4th_order_parabolic_eqn_1d_error}
\end{center}
\end{figure}

Proceeding in the usual way, we find that the true solution satisfies
\beq
  \tu^{n+1}_j = \tu^{n}_j 
  + \dt \left( -\kappa \frac{\partial^4 \tu^n}{\px^4}  
             + f^n_j
        \right)
  + \frac{\dt^2}{2} 
    \left(
      \kappa^2 \frac{\partial^8 \tu^n}{\px^8} 
    - \kappa \frac{\partial^4 f}{\px^4} 
    + \frac{\partial f}{\pt}
    \right)
  + O \left( \dt^3 \right)
  \label{eq:4th_order_parabolic_eqn_1d_time_err}
\eeq
and that the central difference approximation to the bilaplacian satisfies
\beq
  B \tu^n = \frac{\partial^4 \tu}{\px^4} 
  - \frac{7 \dx^4}{240} 
    \frac{\partial^8 \tu}{\px^8} 
  + O(\dx^6)
  \label{eq:4th_order_parabolic_eqn_1d_space_err}.
\eeq
Combining these results with the finite difference 
scheme~(\ref{eq:4th_order_parabolic_eqn_1d_FD_scheme}), we find that the
leading-order local truncation error is given by
\beq
  \tau^n_j = 
     \frac{\partial^8 \tu^n}{\px^8} 
    \left[ \frac{7 \dx^4}{240} - \frac{\kappa \dt}{2}  \right] (\kappa \dt)
    + \frac{\dt^2}{2} 
        \left( \kappa \frac{\partial^4 f}{\px^4} 
             - \frac{\partial f}{\pt}
        \right)
  \label{eq:4th_order_parabolic_eqn_1d_err_eqn}
\eeq
Thus, the optimal time step is $\dto = 7 \dx^4/120\kappa$ and the correction
term is 
\beq
  - \frac{\dt^2}{2} 
      \left( \kappa \frac{\partial^4 f}{\px^4} 
           - \frac{\partial f}{\pt}
      \right).
\eeq
Together, these modifications boost the accuracy of the original
finite difference scheme from fourth- to sixth-order accurate 
overall.  As with the previous examples, the spatial derivatives in the 
correction term should be computed using a finite difference approximation 
that is at least second-order accurate.  
The improved accuracy of (\ref{eq:4th_order_parabolic_eqn_1d_FD_scheme}) 
when the optimal time step and correction term are used is illustrated in 
Figure~\ref{fig:4th_order_parabolic_eqn_1d_error}. 

As indicated by the discussion in this section, applying optimal time step 
selection to high-order PDEs requires the use of high-order discretizations
of the spatial derivatives.  While the need to derive high-order finite 
difference stencils may seem like an unnecessary burden, it is important
to remember that high-order finite difference schemes for spatial derivatives
are almost always necessary to maximize the efficiency of explicit time
integration schemes for high-order PDEs\footnote{Because restrictive time 
step constraints are always a major limitation of explicit schemes for 
time dependent PDEs with high-order spatial 
derivatives~\cite{gko_book,greer_2006}, 
the overall error of finite difference schemes for high-order PDEs is usually 
dominated by the error introduced by the spatial discretization.  As a result, 
it is crucial that numerical schemes for high-order PDEs use high-order 
discretizations for the spatial derivatives.}
Optimal time step selection merely provides a valuable way to leverage the 
effort spent deriving high-order finite difference schemes in order to further 
boost the overall accuracy of the numerical method.

\begin{table}[tb]
\caption{
Computational cost as a function of the global numerical error $e$
for various finite difference schemes that numerically solve the 1D 
fourth-order parabolic equation.  For all finite difference schemes, the 
time step is chosen so that the temporal error is subdominant to the spatial
error.
}
\label{tab:comp_perf_vs_err_4th_order_parabolic} 
\renewcommand{\arraystretch}{1.3}
\begin{tabular}{lcccc}
  \hline
  {\bf Numerical Scheme} & $\dx$ 
  & $\dt$
  & {\bf Memory}
  & {\bf Compute Time}
  \\
  \hline 
  Forward Euler with 
    & \multirow{2}{*}{$O\left( e^{1/2} \right)$} 
    & \multirow{2}{*}{$O\left( e^{2} \right)$}
    & \multirow{2}{*}{$O\left( e^{-1/2} \right)$} 
    & \multirow{2}{*}{$O\left( e^{-5/2} \right)$} \\
  \ \ 2nd-Order Bilaplacian & & & & \\
  Forward Euler with 
    & \multirow{2}{*}{$O\left( e^{1/4} \right)$}
    & \multirow{2}{*}{$O\left( e \right)$}
    & \multirow{2}{*}{$O\left( e^{-1/4} \right)$} 
    & \multirow{2}{*}{$O\left( e^{-{5/4}} \right)$} \\
  \ \ 4th-Order Bilaplacian & & & & \\
  Forward Euler with 
    & \multirow{2}{*}{$O\left( e^{1/6} \right)$} 
    & \multirow{2}{*}{$O\left( e^{2/3} \right)$} 
    & \multirow{2}{*}{$O\left( e^{-1/6} \right)$} 
    & \multirow{2}{*}{$O\left( e^{-5/6} \right)$} \\ 
  \ \ 4th-Order Bilaplacian and OTS & & & & \\
  Crank-Nicholson with 
    & \multirow{2}{*}{$O\left( e^{1/2} \right)$} 
    & \multirow{2}{*}{$O\left( e^{1/2} \right)$} 
    & \multirow{2}{*}{$O\left( e^{-1/2} \right)$} 
    & \multirow{2}{*}{$O\left( e^{-1} \right)$} \\
  \ \ 2nd-Order Bilaplacian & & & & \\
  Crank-Nicholson with 
    & \multirow{2}{*}{$O\left( e^{1/4} \right)$} 
    & \multirow{2}{*}{$O\left( e^{1/2} \right)$} 
    & \multirow{2}{*}{$O\left( e^{-1/4} \right)$} 
    & \multirow{2}{*}{$O\left( e^{-3/4} \right)$} \\
  \ \ 4th-Order Bilaplacian & & & & \\
  \hline
\end{tabular}
\end{table}

Table~\ref{tab:comp_perf_vs_err_4th_order_parabolic} shows the computational 
performance of various finite difference methods for solving 
equation~(\ref{eq:4th_order_parabolic_eqn_1d_second_time_derivative}).
Observe the dramatic decrease in computational cost as a function of the
error by simply replacing a second-order discretization for the bilaplacian 
operator with a fourth-order discretization.  For the forward Euler scheme,
using an optimal time step drives the computational cost down even more.
The performance plot in Figure~\ref{fig:4th_order_parabolic_eqn_1d_perf} 
shows that the theoretical estimates are in good agreement with timings 
from computational experiments.  Note that the empirical performance for the 
forward Euler schemes is better than theoretically expected because the 
computational work per time step is not dominated by the 
$O(1/\dx)$ update calculations until $\dx$ gets very small.

\begin{figure}[tb]
\begin{center}
\scalebox{0.33}{
  \includegraphics{figures/4th_order_parabolic_eqn_1d_comp_time}} 
\caption{Computation time as a function of $L^\infty$ error for four
finite difference schemes that solve the fourth-order parabolic equation
(\ref{eq:4th_order_parabolic_eqn_1d}).  
These results were obtained using MATLAB implementations of the 
finite difference schemes run on a 2.4 GHz MacBook Pro.
Note the impact of round-off error associated with matrix inversion on 
the accuracy of the solution for the two Crank-Nicholson schemes.
See the caption of Figure~\ref{fig:4th_order_parabolic_eqn_1d_error} for 
descriptions of the four finite difference schemes.
}
\label{fig:4th_order_parabolic_eqn_1d_perf}
\end{center}
\end{figure}

In Figure~\ref{fig:4th_order_parabolic_eqn_1d_perf}, observe that the 
2nd-order Crank-Nicholson scheme actually outperforms the OTS scheme over 
the high (but still practically useful) range of errors even though 
Table~\ref{tab:comp_perf_vs_err_4th_order_parabolic} predicts that the OTS
scheme should do better.  The origin of this discrepancy is the constant 
hidden by the big O notation.  In particular, the factor of $7/120$ in 
the optimal time step for the forward Euler scheme with a fourth-order 
approximation of the bilaplacian leads to a relatively large hidden constant 
for the compute time. 
However, as Figures~\ref{fig:4th_order_parabolic_eqn_1d_error} and
\ref{fig:4th_order_parabolic_eqn_1d_perf} show, there is an important 
limitation of the 2nd-order Crank-Nicholson scheme even if we ignore the 
cross-over which will occur at sufficiently small values of the error -- 
round-off error associated with matrix inversion limits the accuracy that is 
achievable by the scheme.  This limitation also exists for the 4th-order 
Crank-Nicholson scheme. 

Comparing the best forward Euler and Crank-Nicholson schemes, we see that
the optimal forward Euler scheme more efficiently utilizes memory at the
cost of requiring more computation time.  This tradeoff between memory and 
computation only exists in one space dimension.  In two-dimensions, both 
schemes require the same amount of compute time; in three or more space 
dimensions, the forward Euler scheme requires less compute time than the
Crank-Nicholson scheme.  


\section{\label{sec:applications_multidim}
         Application to PDEs in Multiple Space Dimensions}
Optimal time step selection can be used to boost the order of accuracy for 
finite difference schemes in any number of space dimensions.  However, 
several important issues arise for problems in more than one space dimension.  
These issues are primarily related to the presence of cross-terms in the 
discretization error, multiple grid spacing parameters,  and the domain 
geometry.  In this section, we show how optimal time step selection easily 
overcomes these issues by using it to construct high-order finite difference
schemes for the 2D advection equation and the 2D diffusion equation.  
It is straightforward to generalize the approach presented in this section to 
more space dimensions and to construct methods for semilinear PDEs by 
incorporating ideas discussed in 
Sections~\ref{sec:optimal_time_step_selection} and~\ref{sec:applications_1d}.  


\subsection{\label{sec:ots_multidim_crossterms}
            Discretization of Spatial Derivatives}
A significant distinction between the error for finite difference schemes in 
one space dimension and multiple space dimensions is the presence of 
cross-terms in the discretization error.  When formally analyzing the accuracy
of a finite difference scheme, it is usually safe to ignore the details of 
these terms because they only appear as higher-order corrections in the error.
However, precise knowledge of the cross-terms is critical when attempting to 
use optimal time step selection.  Without this knowledge, it is impossible to 
ensure cancellation of higher-order errors.  

Recall that optimal time step selection requires higher-order temporal 
errors to be directly related to higher-order spatial errors via the PDE.  
This requirement can be satisfied in one of two ways:
\begin{itemize}
\item by carefully designing the spatial discretization so that 
      higher-order spatial errors are directly related to the spatial 
      derivative operators in the PDE; or
\item by explicitly adding correction terms to cancel out any cross-terms 
      in the original finite difference scheme that cannot be eliminated 
      by using the PDE.
\end{itemize}
These two approaches are actually equivalent because the correction terms 
can be combined with the finite difference stencils in the original scheme 
and be viewed as part of an expanded spatial discretization scheme. 


\subsection{Linear Advection Equation}
For our first application of optimal time step selection in multiple
space dimensions, we consider the two-dimensional advection
equation
\beq
  \frac{\partial u}{\partial t} + \vec{A} \cdot \nabla u = 0,
  \label{eq:advection_eqn_2d}
\eeq
where $\vec{A} = (A_x, A_y)$ is the advection velocity.  
The most interesting and important aspect of this problem is that elimination 
of the truncation error requires optimal selection of the grid spacing ratio 
as well as the time step.  That is, the more general idea of numerical 
parameter optimization is needed in order to boost the accuracy of the scheme.

For convenience, let us assume that $A_x, A_y > 0$.  The simple forward Euler 
scheme for (\ref{eq:advection_eqn_2d}) with first-order upwind discretizations 
of the advection terms is 
\beq
  u^{n+1}_{i,j} = u^{n}_{i,j}
  - A_x \dt \left( \frac{u^{n}_{i,j} - u^{n}_{i-1,j}}{\dx} \right)
  - A_y \dt \left( \frac{u^{n}_{i,j} - u^{n}_{i,j-1}}{\dy} \right)
  \label{eq:advection_eqn_2d_FD_scheme}
\eeq
This method is formally first-order in both space and time with a 
stability constraint of $\dt < \left( A_x/\dx + A_y/\dy \right)^{-1}$.

To compute the optimal time step and grid spacing ratio, we begin by analyzing 
the discretization error 
for~(\ref{eq:advection_eqn_2d_FD_scheme}).  As in our analysis of the finite
difference scheme for the one-dimensional advection equation, we retain all of 
the terms in the discretization error.  Using Taylor series expansions and
the PDE (\ref{eq:advection_eqn_2d}), we find that the true solution $\tu$ 
satisfies
\bea
  \tu^{n+1}_{i,j} &=& \tu^{n}_{i,j }
    + \sum_{k=1}^\infty \frac{\left( -\dt \right)^k}{k!} 
         \left( A_x \partial_x
              + A_y \partial_y \right)^k \tu^{n}.
  \label{eq:advection_eqn_2d_time_err}
  \\
  \frac{\tu^{n}_{i,j} - \tu^{n}_{i-1,j}}{\dx} &=& 
  \frac{\partial \tu}{\px} 
  - \frac{1}{\dx} \sum_{k=2}^\infty \frac{\left( -\dx \right)^k}{k!} 
       \frac{\partial^k \tu^n}{\px^k} 
  \label{eq:advection_eqn_2d_space_err_x}
  \\
  \frac{\tu^{n}_{i,j} - \tu^{n}_{i,j-1}}{\dy} &=&
  \frac{\partial \tu}{\py} 
  - \frac{1}{\dy} \sum_{k=2}^\infty \frac{\left( -\dy \right)^k}{k!} 
       \frac{\partial^k \tu^n}{\py^k} 
  \label{eq:advection_eqn_2d_space_err_y}.
\eea
Therefore, the local truncation error is given by:
\bea
  \tau^{n}_{i,j} &=&
      \frac{A_x \dt}{2} \frac{\partial^2 \tu}{\px^2}
      \left( \dx - A_x \dt \right)
    + \frac{A_y \dt}{2} \frac{\partial^2 \tu}{\py^2}
      \left( \dy - A_y \dt \right)
    - A_x A_y \dt^2 \frac{\partial^2 \tu}{\px \py}
   \nonumber \\
   &+& \frac{A_x\dt}{\dx} \sum_{k=3}^\infty \frac{\left( -\dx \right)^k}{k!} 
       \frac{\partial^k \tu^n}{\px^k} 
   + \frac{A_y\dt}{\dy} \sum_{k=3}^\infty \frac{\left( -\dy \right)^k}{k!} 
       \frac{\partial^k \tu^n}{\py^k} 
   \nonumber \\
   &-& \sum_{k=3}^\infty \frac{\left( -\dt \right)^k}{k!} 
       \left( A_x \partial_x + A_y \partial_y
              \right)^k \tu^{n} 
  \label{eq:advection_eqn_2d_trunc_err}
\eea
From this expression, we see that choosing the ratio of the grid spacings to
be $\dx/\dy = A_x/A_y$ and setting the time step to be 
$\dt_{opt} = \dx/A_x = \dy/A_y$ eliminates two of the three leading-order 
terms in the discretization error.   The last leading-order term can be 
eliminated by adding the correction term
\bea
   A_x A_y \dt^2 \frac{\partial^2 \tu}{\px \py}.
  \label{eq:advection_eqn_2d_corr_term}
\eea
These choices enable us to boost the order of accuracy for the finite 
difference scheme (\ref{eq:advection_eqn_2d_FD_scheme}) from first- to 
second-order.

With a careful choice of discretization for the correction term, we can
boost the order of accuracy even further.  Using the first-order upwind 
discretization for $\frac{\partial^2 \tu}{\px \py}$
\beq
   \frac{ \left(u_{i,j} - u_{i-1,j}\right) 
        - \left(u_{i,j-1} - u_{i-1,j-1}\right)}
        {\dx \dy} 
  \label{eq:advection_eqn_2d_upwind_corr_approx}
\eeq
the truncation error~(\ref{eq:advection_eqn_2d_trunc_err}) becomes
\bea
  \tau^{n}_{i,j} &=&
      \frac{A_x \dt}{2} \frac{\partial^2 \tu}{\px^2}
      \left( \dx - A_x \dt \right)
    + \frac{A_y \dt}{2} \frac{\partial^2 \tu}{\py^2}
      \left( \dy - A_y \dt \right)
   \nonumber \\
   &+& \frac{A_x\dt}{\dx \dy} ( \dy - A_y \dt )
       \sum_{k=3}^\infty \frac{\left( -\dx \right)^k}{k!} 
              \frac{\partial^k \tu^n}{\px^k} 
   \nonumber \\
   &+& \frac{A_y\dt}{\dx \dy} ( \dx - A_x \dt )
       \sum_{k=3}^\infty \frac{\left( -\dy \right)^k}{k!} 
              \frac{\partial^k \tu^n}{\py^k} 
   \nonumber \\
   &+& \frac{A_x A_y\dt^2}{\dx \dy} 
       \sum_{k=3}^\infty \sum_{l=0}^{k}
              (-1)^k {k \choose l}
              \frac{\dx^l \dy^{k-l}}{k!} 
              \frac{\partial^k \tu^n}{\px^l \py^{k-l}} 
   \nonumber \\
   &-& \sum_{k=3}^\infty \frac{\left( -\dt \right)^k}{k!} 
       \left( A_x \partial_x + A_y \partial_y
              \right)^k \tu^{n} 
  \label{eq:advection_eqn_2d_trunc_err_mod},
\eea
which vanishes when the optimal time step and grid spacing ratio are used.
Thus, when (\ref{eq:advection_eqn_2d_upwind_corr_approx}) is used in
conjunction with the optimal time step and grid spacing ratio, we obtain
a finite difference scheme that introduces no truncation error at each time 
step.  Figure~\ref{fig:advection_eqn_2d_soln} demonstrates the amazing accuracy 
of this scheme over the first-order forward Euler 
scheme~(\ref{eq:advection_eqn_2d_FD_scheme}) without any modifications.
Notice how the sharp corners of the initial conditions are perfectly 
preserved when the optimal time step, optimal grid spacing ratio, and 
correction term are used.  In contrast, the sharp corners are
completely smoothed out in the solution computed using the standard 
first-order upwind scheme. 

\begin{figure}[tb]
\begin{center}
\scalebox{0.35}{\includegraphics{figures/adv_eqn_2d_FE_OTS_soln}} 
\scalebox{0.35}{\includegraphics{figures/adv_eqn_2d_FE_soln}} 
\caption{Comparison of numerical solutions for the 2D advection
equation~(\ref{eq:advection_eqn_2d}) using forward Euler time stepping 
with optimal time step and correction term (left) and forward Euler time 
stepping with suboptimal time step (right).  The latter scheme uses a 
time step $\Delta t = \Delta x / 2 (|A_x|+|A_y|)$.  
Both figures show the numerical solution at $t = 3$ computed on the domain 
$-10 < x,y < 10$ using 100 grid points in each direction.
The advection velocity $(A_x, A_y)$ is set to $(-1, -2)$.  The initial 
conditions are taken to be a 2D square function centered at the
origin: $u(x,y,0) = 1$ if $|x| + |y| \le 2$ and 
$u(x,y,0) = 0$ if $|x| + |y| > 2$. 
For the time interval considered, $u$ is identically zero 
on the boundary.
}
\label{fig:advection_eqn_2d_soln}
\end{center}
\end{figure}

It is interesting to push the analysis of the optimal finite difference 
scheme a little further and examine the complete finite difference scheme
(including correction term):
\bea
  u^{n+1}_{i,j} = u^{n}_{i,j}
  &-& A_x \dt \left( \frac{u^{n}_{i,j} - u^{n}_{i-1,j}}{\dx} \right)
  - A_y \dt \left( \frac{u^{n}_{i,j} - u^{n}_{i,j-1}}{\dy} \right)
  \nonumber \\
  &+& A_x A_y \dt^2 
        \left( \frac{u_{i,j} - u_{i-1,j} - u_{i,j-1} + u_{i-1,j-1}}
                    {\dx \dy} 
        \right).
  \label{eq:advection_eqn_2d_FD_scheme_complete}
\eea
Using the relationship between the optimal time step and the grid spacing
ratio, this scheme can be rewritten as
\bea
  u^{n+1}_{i,j} = u^{n}_{i,j}
  &-& \frac{A_x \dt}{2}
    \left( \frac{u^{n}_{i,j} - u^{n}_{i-1,j}}{\dx} 
         + \frac{u^{n}_{i,j-1} - u^{n}_{i-1,j-1}}{\dx} 
    \right)
  \nonumber \\
  &-& \frac{A_y \dt}{2}
    \left( \frac{u^{n}_{i,j} - u^{n}_{i,j-1}}{\dy} 
         + \frac{u^{n}_{i-1,j} - u^{n}_{i-1,j-1}}{\dy} 
    \right),
  \label{eq:advection_eqn_2d_FD_scheme_simplified}
\eea
which is essentially a forward Euler time integration scheme with 
first-order upwind discretizations of the spatial derivatives that are 
computed using all four upwind neighbors.  This formulation of 
(\ref{eq:advection_eqn_2d_FD_scheme_complete}) suggests that the highest
accuracy finite difference scheme for the 2D linear advection equation arises
by using a fully upwind discretization of the advection terms with the 
optimal time step and optimal ratio of grid spacings.

In higher space dimensions, it becomes tedious to carry out the analysis 
to derive the infinite order accurate finite difference scheme for the 
advection equation because many high-order correction terms must be retained.  
However, it is straightforward to generalize 
(\ref{eq:advection_eqn_2d_FD_scheme_simplified}) to $d$ space dimensions by 
using first-order discretizations for the spatial derivatives that are 
averages over the $2^{d-1}$ upwind discretizations in each coordinate 
direction.   As with the two-dimensional problem, the optimal grid spacings 
satisfy $\dx_k/A_{x_k} = \dt_{opt}$ for $1 \le k \le d$.

Like the unit CFL condition for the one-dimensional advection equation, the 
analogue of (\ref{eq:advection_eqn_2d_FD_scheme_simplified}) in any number
of space dimensions could also have been derived by examining how 
characteristic lines of the $d$-dimensional advection equation pass 
through grid points.  For the two-dimensional problem, this perspective 
becomes apparent when we fully simplify 
(\ref{eq:advection_eqn_2d_FD_scheme_simplified}) using the 
optimal time step and grid spacing ratio to obtain
$u^{n+1}_{i,j} = u^{n}_{i-1,j-1}$.



\subsection{Diffusion Equation \label{sec:diffusion_eqn_2d}}
As for PDEs in one space dimension, achieving infinite order accuracy 
through optimal parameter selection is unique to the advection equation.
In general, optimal parameter selection boosts the accuracy by only a few 
orders.  To illustrate the typical accuracy boost gained by using OTS
selection, we apply it to the 2D diffusion equation.  This example underscores 
the need to carefully choose the discretization for the spatial derivatives 
for problems in more than one space dimension and demonstrates the ease with 
which OTS selection can be applied to problems on irregular domains.

In two space dimensions, the diffusion equation may be written as
\beq
  \frac{\partial u}{\pt} = D \nabla^2 u + f(x,y,t).
  \label{eq:diffusion_eqn_2d}
\eeq
The most common finite difference schemes for (\ref{eq:diffusion_eqn_2d}) 
employ a five-point, second-order central difference stencil for the 
Laplacian:
\beq
  L^{5pt} u = \frac{u_{i,j+1} + u_{i,j-1}
                   +u_{i+1,j} + u_{i-1,j} - 4u_{i,j}}{\dx^2},
  \label{eq:laplacian_2d_5pt_stencil}
\eeq
which assumes that the grid spacing in the $x$ and $y$ directions are
equal.  The forward Euler scheme using the five-point stencil is given by
\beq
  u^{n+1}_j = u^{n}_j 
  + \dt 
    \left( D \left[\frac{u^{n}_{i,j+1} + u^{n}_{i,j-1}
             +u^{n}_{i+1,j} + u^{n}_{i-1,j} - 4u^{n}_{i,j}}{\dx^2} \right]
         + f_{i,j}^n
    \right).
  \label{eq:diffusion_eqn_2d_5pt_scheme}
\eeq
This scheme is formally first-order in time and second-order in space.  
The stability constraint $\dt \le \dx^2/4D$ implies that this scheme is
$O(\dx^2)$ accurate overall.

While it is certainly possible to directly apply optimal time step selection 
to (\ref{eq:diffusion_eqn_2d_5pt_scheme}), we would be forced to use additional
correction terms to deal with the fact that the leading-order error for 
(\ref{eq:laplacian_2d_5pt_stencil}), 
$\dx^2 \left(\tu_{xxxx} + \tu_{yyyy}\right)/12$, cannot be directly related 
to the spatial derivative operator in the diffusion equation.  
The analysis is more straightforward if we construct our finite difference 
scheme using the nine-point stencil for the 
Laplacian~\cite{iserles_book,patra_2005}, which does possess a leading-order 
error directly related to the spatial derivative operator in the PDE 
(\ref{eq:diffusion_eqn_2d}):
\beq
  L^{9pt} u = \frac{1}{6 \dx^2} \left( 
      \begin{array}{l}
         \ \ \ u_{i+1,j+1} + u_{i+1,j-1}
            + u_{i-1,j+1} + u_{i-1,j-1} \\
         +\ 4 u_{i+1,j} + 4 u_{i-1,j}
           + 4 u_{i,j+1} + 4 u_{i,j-1}
           -20 u_{i,j} 
      \end{array}
    \right). 
  \label{eq:laplacian_2d_9pt_stencil}
\eeq
Observe that the nine-point stencil is simply the standard five-point 
stencil plus $\dx^2/6$ times a second-order, central difference 
approximation to $u_{xxyy}$.  Therefore, we can obtain the leading-order 
error in the nine-point stencil by combining the leading-order error for the 
five-point stencil with the extra contribution of 
$\dx^2 \tu_{xxyy}/6$
\bea
L^{9pt} \tu &=& \nabla^2 \tu 
              + \frac{\dx^2}{12} 
                \left(\tu_{xxxx} + 2 \tu_{xxyy} + \tu_{yyyy}\right)
              + O(\dx^4)
          \nonumber \\
          &=& \nabla^2 \tu + \frac{\dx^2}{12} \nabla^4 \tu + O(\dx^4).
  \label{eq:laplacian_2d_9pt_stencil_error}
\eea
Like (\ref{eq:diffusion_eqn_2d_5pt_scheme}), the forward Euler scheme that 
uses the nine-point discretization of the Laplacian 
\beq
  u^{n+1}_{i,j} = u^{n}_{i,j}
  + \dt \left( D L^{9pt} u + f_{i,j}^n \right)
  \label{eq:diffusion_eqn_2d_9pt_scheme}
\eeq
is $O(\dx^2)$ accurate overall because it has a stability constraint 
$\dt \le 3\dx^2/8D = O(\dx^2)$.
It is interesting to note that use of a nine-point stencil for the Laplacian 
naturally arises when directly applying optimal time step selection to the
five-point scheme if the correction term is interpreted as a modification 
to the original spatial discretization.

To apply optimal time step selection to (\ref{eq:diffusion_eqn_2d_9pt_scheme}), we proceed in the usual way by first analyzing the leading-order terms of the 
discretization error for the finite difference scheme.  Taylor series 
expansions and the PDE show that the true solution satisfies 
\bea
  \tu^{n+1}_{i,j} = \tu^{n}_{i,j}
  + \dt \left(\nabla^2 \tu^{n} +f^n_{i,j} \right)
  + \frac{(D \dt)^2}{2} \nabla^4 \tu^{n}
  + \frac{\dt^2}{2} \left( D\nabla^2 f + \frac{\partial f}{\pt} \right)
  + O \left( \dt^3 \right)
  \label{eq:diffusion_eqn_2d_time_err} 
\eea
Combining this result with~(\ref{eq:laplacian_2d_9pt_stencil_error}), 
we find that the leading-order terms in the 
local truncation error for the finite difference 
scheme (\ref{eq:diffusion_eqn_2d_9pt_scheme}) are
\bea
  \tau^{n}_j = 
  \nabla^4 \tu
      \left[ \frac{\dx^2}{12} - \frac{D \dt}{2}  \right] (D \dt)
  - \frac{\dt^2}{2} \left( D\nabla^2 f + \frac{\partial f}{\pt} \right).
  \label{eq:diffusion_eqn_2d_trunc_err}
\eea
As for the 1D diffusion equation, we see that the optimal time step is given 
by $\dto = \dx^2/6D$ and the correction term is 
\beq
  \frac{\dt^2}{2} \left( D\nabla^2 f + \frac{\partial f}{\pt} \right).
\eeq
This choice of time step and correction term yields a scheme that is 
fourth-order accurate.  

\begin{figure}[tb]
\begin{center}
\scalebox{0.33}{\includegraphics{figures/diffusion_eqn_2d_src_error_vs_N}} 
\ \ 
\scalebox{0.33}{\includegraphics{figures/diffusion_eqn_2d_src_comp_time}} 
\caption{$L^\infty$ error as a function of number of grid points (left)
and computation time as a function of $L^\infty$ error (right) for three
finite difference schemes that solve the 2D diffusion equation:
forward Euler with optimal time step and correction term (circles), forward 
Euler with suboptimal time step (squares), and Crank-Nicholson (diamonds).  
The forward Euler schemes use a nine-point discretization of the Laplacian;
the Crank-Nicholson scheme uses the standard five-point discretization of
the Laplacian.  
Note that the errors for the forward Euler with suboptimal time step and 
Crank-Nicholson schemes lie almost directly on top of each other at the 
resolution of the figures.  
These results were obtained using MATLAB implementations of the 
finite difference schemes run on a 2.4 GHz MacBook Pro.
}
\label{fig:diffusion_eqn_2d_src_analysis}
\end{center}
\end{figure}
The improvement in the accuracy of the forward Euler scheme when the optimal 
time step is used is shown in Figure~\ref{fig:diffusion_eqn_2d_src_analysis}.
Figure~\ref{fig:diffusion_eqn_2d_src_analysis} also shows that the 
scaling of the computational time with the error is in good agreement with 
theoretical estimates (see Table~\ref{tab:comp_perf_vs_dim}).  As with the
other examples, the forward Euler scheme with an optimal time step is much 
more computationally efficient than the two other schemes.  


\subsubsection{Irregular Domains}
All of the examples we have considered so far share an important feature: they 
are all defined on simple, rectangular domains.  Thus, any of several methods 
could have been used to obtain solutions with similar or even higher accuracy.
For example, a fourth-order accurate solution to the diffusion equation
(in any number of space dimensions) could be obtained by using a 
pseudospectral spatial 
discretization~\cite{trefethen_spectral_book,boyd_spectral_book} 
of the Laplacian and a fourth-order time integration scheme 
(\eg Runge-Kutta).  When the domain is irregularly shaped, high-order methods 
are harder to design and implement.  
In this section, we extend the OTS finite difference scheme for the 2D 
diffusion equation on regular domains to irregular domains.  Other 
researchers have developed fourth-order accurate methods for the diffusion 
equation on irregular domains~\cite{gibou_2005,ito_2005}.  However, these 
earlier methods require a wider ghost cell region~\cite{gibou_2005}, use
implicit time integration~\cite{gibou_2005,ito_2005}, or involve a more 
complex calculation for the boundary conditions~\cite{ito_2005}.  As we shall 
see, it is possible to achieve fourth-order accuracy for the diffusion 
equation on irregular domains using only forward Euler integration and a 
compact, second-order stencil for the Laplacian.

% FIGURE SHOWING GHOST CELLS AT IRREGULAR BOUNDARY
% PLACED HERE TO SPREAD FIGURES OUT
\begin{figure}[tb]
\begin{center}
\scalebox{0.25}{\includegraphics{figures/ghostcell_edge}} 
\ \ \ \ \ \ \ \ \ \ \ \ \ 
\scalebox{0.25}{\includegraphics{figures/ghostcell_corner}}
\caption{Illustrations of edge (left) and corner (right) ghost cells.
The edge ghost cell, $u_E$, is filled by using cubic extrapolation of 
the value on the boundary, $u_B$, and values at three interior grid points.  
The corner ghost cell, $u_C$, is filled by using a fourth-order accurate
Taylor series expansion centered at $u_{0,0}$, which uses the values of $u$ 
at the specified interior grid points and neighboring edge ghost cells to 
approximate the partial derivatives in the expansion. 
}
\label{fig:ghost_cells}
\end{center}
\end{figure}

To avoid the need for special stencils at grid points near the irregular 
boundary, we adopt the `ghost cell' approach for imposing boundary 
conditions~\cite{gibou_2005,ito_2005,fedkiw_1999,osher_fedkiw_book}.
The main challenge in using the ghost cell method is ensuring ghost cells 
are filled using a sufficiently high-order extrapolation scheme. 
Figure~\ref{fig:ghost_cells} shows examples of ghost cells that lie in the 
vicinity of an irregular boundary.  Notice that there are two types of ghost 
cells:  edge and corner.  Edge and corner ghost cells are distinguished by 
the relative position of the nearest interior grid point.  An edge ghost cell 
is linked to its nearest interior neighbor by an edge of the computational 
grid whereas a corner ghost cell and its nearest interior neighbor lie on the 
opposite corners of a grid cell.

To set the value of $u$ in each edge ghost cell, we use 1D cubic 
(\ie fourth-order accurate) extrapolation of the values of $u$ across the 
interface.  A cubic Lagrange interpolant is constructed for each edge ghost 
cell using a point on the domain boundary and three interior grid points that 
lie along the line parallel to the edge connecting the ghost cell to its 
nearest interior neighbor (see Figure~\ref{fig:ghost_cells})\footnote{If
a level set representation of the boundary~\cite{osher_fedkiw_book} is used, 
the location of the point $u_B$ can be calculated by inverting the linear 
interpolant of $\phi$ that passes through the ghost cell and its nearest
interior neighbor.  We found that using higher-order interpolants to 
locate boundary points was unnecessary for achieving high-order accuracy in 
the computed solution.}.  Because the quality of the interpolant deteriorates 
if the boundary point $u_B$ is too close to any of the interior grid points 
used to construct the Lagrange extrapolant, we follow \cite{gibou_2005} and 
choose the interior grid points so that the nearest interior grid point is 
sufficiently far from the boundary point.  Without this procedure, the errors 
introduced in the values of the ghost cells lead to instability of the 
numerical method.
Gibou~\etal~suggest shifting the interpolation points by one grid point 
when the distance between the boundary point and the nearest interior grid 
point is less than $\dx^2$~\cite{gibou_2005}.  For the numerical scheme 
presented in this paper, this threshold was too low.  Better stability was 
obtained if an $O(\dx)$ threshold was used.

% FIGURE SHOWING SOLUTION OF 2D DIFFUSION EQUATION ON STARFISH DOMAIN
% PLACED HERE TO SPREAD FIGURES OUT
\begin{figure}[tb]
\begin{center}
\scalebox{0.35}{\includegraphics{figures/diffusion_eqn_2d_starfish_domain_soln}} 
\scalebox{0.35}{\includegraphics{figures/diffusion_eqn_2d_starfish_domain_error}} 
\caption{Numerical solutions (left) and dominant error (right) for the 2D 
diffusion equation on a starfish-shaped domain.  The solution is computed 
using forward Euler time stepping with an optimal time step and correction 
term.  In the error plot, the dark regions represent points 
where the error in the solution is larger than $25$\% of the $L^\infty$ error 
of the solution.  
}
\label{fig:diffusion_eqn_2d_starfish_domain}
\end{center}
\end{figure}

To set the value of $u$ in a corner ghost cell, we use a fourth-order accurate
Taylor series expansion of $u$ centered at the nearest interior 
neighbor.  The partial derivatives in the Taylor series expansion are 
approximated using finite differences constructed from the values of $u$ 
at interior grid points and the neighboring edge ghost cells (see 
Figure~\ref{fig:ghost_cells}).  For the corner ghost cell shown 
in Figure~\ref{fig:ghost_cells}, the extrapolation stencil is given by
\bea
  u_C &=&  -4 u_{0,0} - u_{-1,-1} + 2 u_{1,0} + 2 u_{0,1}
      - u_{1,-1} - u_{-1,1} + 2 u_{0,-1} + 2 u_{-1,0}
\eea
where $u_C$ and $u_{i,j}$ are indicated in the figure.  The stencils for
corner ghost cells that are in other positions relative to the interior of 
the domain are obtained by rotations of Figure~\ref{fig:ghost_cells} and 
remapping of the indices in the above stencil.

Using these methods for filling edge and corner ghost cells, it is 
straightforward to compute high-order accurate solutions of the 2D diffusion 
equation on irregular domains.  We simply use the OTS forward Euler scheme 
designed for regular domains for grid points in the interior of the domain
after filling the ghost cells with high-order accurate values.  
Figure~\ref{fig:diffusion_eqn_2d_starfish_domain} shows an example of 
a solution computed on a starfish shaped domain.  It also shows that the 
error in the solution is concentrated near the boundaries of the irregular
domain.  The improved accuracy of the OTS solution compared to a simple 
forward Euler scheme with a suboptimal time step is illustrated in 
Figure~\ref{fig:diffusion_eqn_2d_starfish_error}. 

% FIGURE SHOWING SOLUTION OF 2D DIFFUSION EQUATION ON STARFISH DOMAIN
% PLACED HERE TO SPREAD FIGURES OUT
\begin{figure}[tb]
\begin{center}
\scalebox{0.35}{
  \includegraphics{figures/diffusion_eqn_2d_starfish_domain_error_vs_N}} 
\caption{$L^\infty$ error as a function of number of grid points for two
finite difference schemes that solve the 2D diffusion equation on an 
irregular domain: forward Euler with optimal time step and correction 
terms (circles) and forward Euler with suboptimal time step (squares).  
}
\label{fig:diffusion_eqn_2d_starfish_error}
\end{center}
\end{figure}


\subsubsection{Diffusion Equation in Higher Dimensions}
Using optimal time step selection to boost the accuracy of finite difference
schemes for the diffusion equation in higher space dimensions is 
straightforward.  As for the 2D problem, the key step is identification of a 
finite difference stencil for the Laplacian that has an \emph{isotropic} 
discretization error.  For 3D problems, a catalog of several such stencils is 
available in~\cite{patra_2005}.   For higher dimensional problems, one simple
approach for deriving an isotropic finite difference stencil for the Laplacian
would be to start with the generalization of the standard five point stencil
for the 2D Laplacian and add finite difference approximations for the missing 
cross terms that are required to make the leading-order error isotropic 
(\ie proportional to the bilaplacian of the solution).  Because the missing 
terms are all of the form 
\beq
\frac{\dx^2}{6} \left(\frac{\partial^4 u}{\partial x_i^2 \partial x_j^2}\right),
\eeq
this approach is relatively easy to use.  To derive finite difference 
approximations with more general or complex properties, symbolic algebra 
software can be helpful~\cite{patra_2005,gupta_1998}.  

Once an acceptable finite difference approximation for the Laplacian has been 
chosen, the usual OTS analysis yields an optimal time step of 
$\dt_{opt} = \dx^2/6D$ for forward Euler time integration and a boost of the 
order of accuracy from two to four.  Above three dimensions, it is necessary 
to use an implicit time integration scheme if $\dt_{opt}$ is no longer 
stable for the forward Euler scheme.

Problems on irregular domains can be handled using the ghost cell approach. 
While the derivation of high accuracy stencils for ghost cells becomes more
tedious, the general approach is the same as for the 2D problem.  The ghost 
cells can first be grouped into separate classes based on the number of 
grid cell edges that must be traversed to reach the nearest interior neighbor.
The values in the ghost cells can then be set in order starting with those 
directly connected to their nearest interior neighbor and ending with those 
whose nearest interior neighbor is on the opposite corner of a grid cell.
Here, too, symbolic algebra programs can be helpful when deriving methods for 
extrapolating interior and boundary values to ghost cells.


\section{\label{sec:summary} Summary} 
In this paper, we have presented a novel approach for constructing high-order
finite difference methods for time dependent PDEs \emph{without} requiring
the use of high-order stencils or high-order time integration schemes.  
The basic idea is that the leading-order terms in the discretization error
can be eliminated by carefully choosing the time step and possibly adding
a few simple correction terms.  It is straightforward to derive both the 
optimal time step and the correction terms by (1) taking advantage of the 
regular structure of finite difference schemes and (2) making use of the
PDE to relate terms in the discretization error.  The boost in the order
of accuracy achieved when the optimal time step and correction terms are
used is well worth the extra effort required to explicitly retain and analyze 
the leading-order terms in the discretization error.   

Through many examples, we have demonstrated the utility of optimal time step
selection to a wide range of problems.  We showed how OTS selection can be 
used to very easily obtain high-order accurate solutions to many linear 
and semilinear PDEs in any number of space dimensions on both regular
and irregular domains.  The examples illustrate the surprisingly high-order
of accuracy that can be achieved using only low-order discretizations for 
spatial derivatives and simple forward Euler time integration.

Optimal time step selection is a simple example of the more general technique
of optimally selecting numerical parameters to boost the accuracy of 
numerical methods.  Little research appears to have been done in this area,
but, as OTS selection demonstrates, optimal selection of numerical parameters 
can significantly impact the accuracy of numerical methods.  To realize
the full potential of numerical methods, both optimal time step selection 
and optimal numerical parameter selection deserve further investigation.


% ACKNOWLEDGMENTS
\section*{Acknowledgments}
The author gratefully acknowledges the support of Vitamin D, Inc.
and the Institute for High-Performance Computing (IHPC) in Singapore. 
The author would like to thank P. Fok, M. Prodanovi\'c, and A. Chiu for 
helpful suggestions on the manuscript.  The author particularly thanks P. Fok 
for many enlightening discussions. 


\appendix
\section{Formal vs. Practical Accuracy
         \label{app:formal_vs_practical_accuracy} }
For time dependent PDEs, evaluating the order of accuracy for a numerical
method is subtle because there are formally two separate orders of accuracy 
to consider:  temporal and spatial.  While it is theoretically
interesting and important to understand how the error depends on both the 
grid spacing $\dx$ and the time step $\dt$, in practice, the accuracy 
of a numerical scheme is always controlled by only one of the two numerical
parameters.  

Even though spatial and temporal orders of accuracy for a numerical method
are formally separate, one will always dominate for a given choice of 
$\dx$ and $\dt$.  For example, when solving the diffusion equation 
using the backward Euler method for time integration with a second-order 
central difference stencil for the Laplacian, formal analysis shows that 
the global error is $O(\dx^2) + O(\dt)$.  Since there are no 
stability constraints on the numerical parameters, the time
step and grid spacing are free to vary independently.  In this situation, the 
practical error for the method depends on the relative sizes of the time step 
and grid spacing.  When $\dt \gg \dx^2$, the practical error is 
$O(\dt)$ which means that the error in the numerical solution is 
primarily controlled by the time step.  Similarly, when 
$\dt \ll \dx^2$, the practical error is $O(\dx^2)$ so that 
the error is controlled by the grid spacing.  Finally, when 
$\dt  = O(\dx^2)$, the practical error is 
$O(\dt) = O(\dx^2)$.  In all cases, the practical error is 
primarily controlled by one of the two numerical parameters, and varying
the subdominant parameter while holding the dominant parameter fixed does 
not significantly affect the error.
 
When there are constraints on the numerical parameters, there is less freedom 
in choosing the controlling parameter.  For instance, if we solve the 
diffusion equation using a forward Euler time integration scheme with a 
second-order central difference stencil for the Laplacian, stability
considerations require that we choose $\dt = O(\dx^2)$.  
Combining this stability constraint with the formal error for the scheme
shows that the practical error is 
$O(\dx^2) + O(\dt) = O(\dx^2)$.  Thus, the accuracy of the 
method is completely controlled by the grid spacing; the temporal error can 
never dominate the spatial error.

\bibliography{OTSPDE}

\end{document}
